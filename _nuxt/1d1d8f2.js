(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{370:function(e,t,n){"use strict";var r=n(6),o=n(10);r({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return o(URL.prototype.toString,this)}})},372:function(e,t,n){"use strict";n.r(t);function r(e,p){return r=Object.setPrototypeOf||function(e,p){return e.__proto__=p,e},r(e,p)}function o(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function c(e,t,n){return c=o()?Reflect.construct:function(e,t,n){var a=[null];a.push.apply(a,t);var o=new(Function.bind.apply(e,a));return n&&r(o,n.prototype),o},c.apply(null,arguments)}var f=n(148);var d=n(179),m=n(109);function l(e){return function(e){if(Array.isArray(e))return Object(f.a)(e)}(e)||Object(d.a)(e)||Object(m.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var h=n(20),v=n(9),w=(n(52),n(370),n(126),n(31),n(242),n(16),n(67),n(178),n(68),n(41),function(){var e=Object(v.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n=e;t.slice().reverse().forEach((function(e){var t=n,r=function(){var n=Object(v.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e();case 2:t();case 3:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();n=r})),n()})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),x={get:function(path){return fetch("".concat("","/").concat(path||"")).then((function(e){return e.json()}))},post:function(path,data){return fetch("".concat("","/").concat(path),{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)}).then((function(e){return e.json()}))},put:function(path,data){return fetch("".concat("","/").concat(path),{method:"PUT",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)}).then((function(e){return e.json()}))},del:function(path){return fetch("".concat("","/").concat(path),{method:"DELETE",mode:"cors"}).then((function(e){return e.json()}))},loadScript:function(e){return new Promise((function(t){var script=document.createElement("script");script.onload=function(){t()},script.src=e,document.body.appendChild(script)}))},loadStyle:function(e){return new Promise((function(t){var style=document.createElement("link");style.rel="stylesheet",style.type="text/css",style.onload=function(){t()},style.href=e,document.head.appendChild(style)}))},asyncSerializeExec:w},y={"中国":8,"河北省":2,"内蒙古自治区":2,"黑龙江省":2},k="before-created",j="before-bounds-fetch",O="before-bounds-plot",R={props:{context:Object,data:[Object,Array]},data:function(){return{map:null}},watch:{data:function(){this.init()}},mounted:function(){var e=this;return Object(v.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.init();case 1:case"end":return t.stop()}}),t)})))()},destroyed:function(){this.destroy()},methods:{destroy:function(){this.map&&this.map.destroy()},init:function(){var e=this;return Object(v.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.data){t.next=3;break}return e.$emit("created"),t.abrupt("return");case 3:return e.$emit("before-created"),performance.clearMeasures(),performance.mark(k),t.next=8,e.createMap();case 8:n=t.sent,performance.measure("create map",k),e.$emit("created",n),e.showMeasure("create map"),e.showMeasure("fetch-bounds"),e.showMeasure("plot-bounds"),console.log(performance.toJSON());case 15:case"end":return t.stop()}}),t)})))()},showMeasure:function(e){var t=performance.getEntriesByName(e,"measure")[0],n=t.startTime,r=t.duration;console.log("[".concat(e,"] startTime: ").concat(n,"ms duration: ").concat(r,"ms"))},createMap:function(){var e=this;return Object(v.a)(regeneratorRuntime.mark((function t(){var n,r,o,c,f,d,m,l,w,x,k,j,mask,map;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.data,r=n.id,o=n.na,c=n.zm,f=Object(h.a)(n.ce,2),d=f[0],m=f[1],l=r.split("-"),w=Object(h.a)(l,2),x=w[0],w[1],"street"!==x){t.next=4;break}return t.abrupt("return");case 4:return e.destroy(),k=performance.now(),t.next=8,e.getBounds();case 8:return j=t.sent,console.log("".concat(x," ").concat(o," : ").concat(performance.now()-k," 毫秒\n\n")),j=e.findMaxNBounds(j,y[o]||1),mask=e.getMask(j),map=new AMap.Map(e.$refs.map,{mask:mask,mapStyle:"amap://styles/e5e8b14a1816b415fc89d291224242c6",animateEnable:!1,layers:[],zoom:c,center:[d,m]}),window.map=e.map=map,e,t.abrupt("return",new Promise((function(t){map.on("complete",Object(v.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.emitClick(map),n.next=3,e.drawDistrict(j);case 3:r=n.sent,t({map:map,districts:r});case 5:case"end":return n.stop()}}),n)}))))})));case 16:case"end":return t.stop()}}),t)})))()},drawDistrict:function(e){var t=this;return Object(v.a)(regeneratorRuntime.mark((function n(){var r,o,c,f;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=t.getChildren()){n.next=4;break}return t.drawBounds(e),n.abrupt("return",[t.data]);case 4:if(o=t.data,c=o.id,o.na,"district"!==c.split("-")[0]){n.next=10;break}t.drawBounds(e),n.next=16;break;case 10:return f=[],performance.mark(j),n.next=14,x.asyncSerializeExec(r.map((function(e){return Object(v.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.getMaxNBounds(e);case 2:r=n.sent,f=f.concat(r);case 4:case"end":return n.stop()}}),n)})))})));case 14:performance.measure("fetch-bounds",j),t.drawBounds(f);case 16:return n.abrupt("return",r);case 17:case"end":return n.stop()}}),n)})))()},getMaxNBounds:function(e){var t=arguments,n=this;return Object(v.a)(regeneratorRuntime.mark((function r(){var o,c,f,d,m,l,v,w,x;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o=t.length>1&&void 0!==t[1]?t[1]:1,c=e.id,f=e.na,d=c.split("-"),m=Object(h.a)(d,2),l=m[0],v=m[1],"province"!==l){r.next=11;break}return x=performance.now(),r.next=7,n.fetchBounds(c);case 7:w=r.sent,console.log("province %s: %s 毫秒\n\n",f,performance.now()-x),r.next=14;break;case 11:return r.next=13,n._getBounds(l,v);case 13:w=r.sent;case 14:return r.abrupt("return",n.findMaxNBounds(w,y[f]||o));case 15:case"end":return r.stop()}}),r)})))()},findMaxNBounds:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=e.map((function(e,i){return[e.length,i]})),r=n.length;if(r<=1)return e;t>r&&(t=r);for(var i=0;i<t;i++)for(var o=r-1;o>i;o--)if(n[o][0]>n[o-1][0]){var c=n[o];n[o]=n[o-1],n[o-1]=c}var f=n.slice(0,t).map((function(t){return e[t[1]]}));return f},getChildren:function(){return this.context.children},getBounds:function(){var e=this;return Object(v.a)(regeneratorRuntime.mark((function t(){var n,r,o,c,f,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.data,r=n.id,n.na,o=r.split("-"),c=Object(h.a)(o,2),f=c[0],d=c[1],"country"!==f){t.next=8;break}return t.next=5,e.fetchBounds("china");case 5:case 11:case 16:return t.abrupt("return",t.sent);case 8:if("province"!==f){t.next=14;break}return t.next=11,e.fetchBounds(r);case 14:return t.next=16,e._getBounds(f,d);case 17:case"end":return t.stop()}}),t)})))()},_getBounds:function(e,t){var n=new AMap.DistrictSearch({subdistrict:0,extensions:"all",level:e});return new Promise((function(e){n.search(t,(function(t,n){var r=n.districtList;if(r&&r.length){var o=r[0].boundaries;e(o)}}))}))},fetchBounds:function(e){return Object(v.a)(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=performance.now(),t.next=3,x.get("bounds/".concat(e,".json")).then((function(e){var t=performance.now();return console.log("fetchEnd: %s 毫秒",t-n),e=e.map((function(e){return e.map((function(e){return c(AMap.LngLat,l(e))}))})),console.log("创建 AMap.LngLat: %s 毫秒",performance.now()-t),e}));case 3:return r=t.sent,t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)})))()},getMask:function(e){for(var mask=[],i=0;i<e.length;i++)mask.push([e[i]]);return mask},emitClick:function(e){var t=this;e.on("click",(function(n){t.$emit("click",{target:e,event:n})}))},drawBounds:function(e){performance.mark(O);for(var t=[],i=0,n=e.length;i<n;i++){var polygon=new AMap.Polygon({bubble:!1,strokeWeight:1,path:e[i],fillOpacity:1,fillColor:function(){return"#fff"},strokeColor:"#000"});this.emitClick(polygon),t.push(polygon)}this.map.add(t),this.map.setFitView(t),performance.measure("plot-bounds",O)}}},B=R,M=n(53),component=Object(M.a)(B,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{height:"100%",position:"relative"}},[n("div",{ref:"map",staticStyle:{height:"100%"}}),e._v(" "),e._t("default")],2)}),[],!1,null,null,null);t.default=component.exports}}]);